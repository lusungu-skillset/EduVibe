pipeline {
    agent { label 'eduvibe-agent' }

    tools {
        nodejs 'Node20'   // ğŸ‘ˆ set up Node24 in Jenkins global tools
    }

    environment {
        NODE_ENV = 'development'   // ğŸ‘ˆ use development so devDependencies (eslint, vite) are installed
    }

    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }

        stage('Install Dependencies') {
            steps {
                dir('eduvibe') {
                    sh 'node -v'
                    sh 'npm -v'
                    sh 'npm ci --include=dev'
                }
            }
        }

        stage('Lint') {
            steps {
                dir('eduvibe') {
                    sh 'npm run lint -- --max-warnings=0'

                }
            }
        }

        stage('Build') {
            steps {
                dir('eduvibe') {
                    sh 'npm run build'
                }
            }
        }
    }

    post {
        always {
            echo 'Cleaning up workspace'
            deleteDir()
        }
        success {
            echo 'âœ… Build and lint successful!'
        }
        failure {
            echo 'âŒ Build or lint failed!'
        }
    }
}
